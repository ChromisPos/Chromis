<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

  
    <changeSet author="Chromis POS" id="Add foreign keys prior to v0.7" dbms="mysql">  
        <sql>set foreign_key_checks = 0</sql> 
        <sql>ALTER TABLE PEOPLE ADD CONSTRAINT PEOPLE_FK_1 FOREIGN KEY (ROLE, SITEGUID) REFERENCES ROLES(ID, SITEGUID)</sql>        
        <sql>ALTER TABLE CUSTOMERS ADD CONSTRAINT CUSTOMERS_TAXCAT FOREIGN KEY (TAXCATEGORY, SITEGUID) REFERENCES TAXCUSTCATEGORIES(ID, SITEGUID)</sql>
        <sql>ALTER TABLE CATEGORIES ADD CONSTRAINT CATEGORIES_FK_1 FOREIGN KEY (PARENTID, SITEGUID) REFERENCES CATEGORIES(ID, SITEGUID)</sql>
        <sql>ALTER TABLE TAXES ADD CONSTRAINT TAXES_CAT_FK FOREIGN KEY (CATEGORY, SITEGUID) REFERENCES TAXCATEGORIES(ID, SITEGUID)</sql>
        <sql>ALTER TABLE TAXES ADD CONSTRAINT TAXES_CUSTCAT_FK FOREIGN KEY (CUSTCATEGORY, SITEGUID) REFERENCES TAXCUSTCATEGORIES(ID, SITEGUID)</sql>
        <sql>ALTER TABLE TAXES ADD CONSTRAINT TAXES_TAXES_FK FOREIGN KEY (PARENTID, SITEGUID) REFERENCES TAXES(ID, SITEGUID)</sql>
        <sql>ALTER TABLE ATTRIBUTEVALUE ADD CONSTRAINT ATTVAL_ATT FOREIGN KEY (ATTRIBUTE_ID, SITEGUID) REFERENCES ATTRIBUTE(ID, SITEGUID) ON DELETE CASCADE</sql>
        <sql>ALTER TABLE ATTRIBUTEUSE ADD CONSTRAINT ATTUSE_SET FOREIGN KEY (ATTRIBUTESET_ID, SITEGUID) REFERENCES ATTRIBUTESET(ID, SITEGUID) ON DELETE CASCADE</sql>
        <sql>ALTER TABLE ATTRIBUTEUSE ADD CONSTRAINT ATTUSE_ATT FOREIGN KEY (ATTRIBUTE_ID, SITEGUID) REFERENCES ATTRIBUTE(ID, SITEGUID)</sql>
        <sql>ALTER TABLE ATTRIBUTESETINSTANCE ADD CONSTRAINT ATTSETINST_SET FOREIGN KEY (ATTRIBUTESET_ID, SITEGUID) REFERENCES ATTRIBUTESET(ID, SITEGUID) ON DELETE CASCADE</sql>
        <sql>ALTER TABLE ATTRIBUTEINSTANCE ADD CONSTRAINT ATTINST_SET FOREIGN KEY (ATTRIBUTESETINSTANCE_ID, SITEGUID) REFERENCES ATTRIBUTESETINSTANCE(ID, SITEGUID) ON DELETE CASCADE</sql>
        <sql>ALTER TABLE ATTRIBUTEINSTANCE ADD CONSTRAINT ATTINST_ATT FOREIGN KEY (ATTRIBUTE_ID, SITEGUID) REFERENCES ATTRIBUTE(ID, SITEGUID)</sql>
        <sql>ALTER TABLE PRODUCTS ADD CONSTRAINT PRODUCTS_FK_1 FOREIGN KEY (CATEGORY, SITEGUID) REFERENCES CATEGORIES(ID, SITEGUID)</sql>
        <sql>ALTER TABLE PRODUCTS ADD CONSTRAINT PRODUCTS_TAXCAT_FK FOREIGN KEY (TAXCAT, SITEGUID) REFERENCES TAXCATEGORIES(ID, SITEGUID)</sql>
        <sql>ALTER TABLE PRODUCTS ADD CONSTRAINT PRODUCTS_ATTRSET_FK FOREIGN KEY (ATTRIBUTESET_ID, SITEGUID) REFERENCES ATTRIBUTESET(ID, SITEGUID)</sql>
        <sql>ALTER TABLE PRODUCTS_COM ADD CONSTRAINT PRODUCTS_COM_FK_1 FOREIGN KEY (PRODUCT, SITEGUID) REFERENCES PRODUCTS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE PRODUCTS_COM ADD CONSTRAINT PRODUCTS_COM_FK_2 FOREIGN KEY (PRODUCT2, SITEGUID) REFERENCES PRODUCTS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE STOCKDIARY ADD CONSTRAINT STOCKDIARY_FK_1 FOREIGN KEY (PRODUCT, SITEGUID) REFERENCES PRODUCTS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE STOCKDIARY ADD CONSTRAINT STOCKDIARY_ATTSETINST FOREIGN KEY (ATTRIBUTESETINSTANCE_ID, SITEGUID) REFERENCES ATTRIBUTESETINSTANCE(ID, SITEGUID)</sql>
        <sql>ALTER TABLE STOCKDIARY ADD CONSTRAINT STOCKDIARY_FK_2 FOREIGN KEY (LOCATION, SITEGUID) REFERENCES LOCATIONS(ID, SITEGUID)</sql>        
        <sql>ALTER TABLE STOCKLEVEL ADD CONSTRAINT STOCKLEVEL_PRODUCT FOREIGN KEY (PRODUCT, SITEGUID) REFERENCES PRODUCTS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE STOCKLEVEL ADD CONSTRAINT STOCKLEVEL_LOCATION FOREIGN KEY (LOCATION, SITEGUID) REFERENCES LOCATIONS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE STOCKCURRENT ADD CONSTRAINT STOCKCURRENT_FK_1 FOREIGN KEY (PRODUCT, SITEGUID) REFERENCES PRODUCTS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE STOCKCURRENT ADD CONSTRAINT STOCKCURRENT_ATTSETINST FOREIGN KEY (ATTRIBUTESETINSTANCE_ID, SITEGUID) REFERENCES ATTRIBUTESETINSTANCE(ID, SITEGUID);</sql>
        <sql>ALTER TABLE STOCKCURRENT ADD CONSTRAINT STOCKCURRENT_FK_2 FOREIGN KEY (LOCATION, SITEGUID) REFERENCES LOCATIONS(ID, SITEGUID);</sql>
        <sql>ALTER TABLE RECEIPTS ADD CONSTRAINT RECEIPTS_FK_MONEY FOREIGN KEY (MONEY, SITEGUID) REFERENCES CLOSEDCASH(MONEY, SITEGUID)</sql>
        <sql>ALTER TABLE TICKETS ADD CONSTRAINT TICKETS_FK_ID FOREIGN KEY (ID, SITEGUID) REFERENCES RECEIPTS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE TICKETS ADD CONSTRAINT TICKETS_FK_2 FOREIGN KEY (PERSON, SITEGUID) REFERENCES PEOPLE(ID, SITEGUID)</sql>
        <sql>ALTER TABLE TICKETS ADD CONSTRAINT TICKETS_CUSTOMERS_FK FOREIGN KEY (CUSTOMER, SITEGUID) REFERENCES CUSTOMERS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE TICKETLINES ADD CONSTRAINT TICKETLINES_FK_TICKET FOREIGN KEY (TICKET, SITEGUID) REFERENCES TICKETS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE TICKETLINES ADD CONSTRAINT TICKETLINES_FK_2 FOREIGN KEY (PRODUCT, SITEGUID) REFERENCES PRODUCTS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE TICKETLINES ADD CONSTRAINT TICKETLINES_ATTSETINST FOREIGN KEY (ATTRIBUTESETINSTANCE_ID, SITEGUID) REFERENCES ATTRIBUTESETINSTANCE(ID, SITEGUID)</sql>
        <sql>ALTER TABLE TICKETLINES ADD CONSTRAINT TICKETLINES_FK_3 FOREIGN KEY (TAXID, SITEGUID) REFERENCES TAXES(ID, SITEGUID)</sql>
        <sql>ALTER TABLE PAYMENTS ADD CONSTRAINT PAYMENTS_FK_RECEIPT FOREIGN KEY (RECEIPT, SITEGUID) REFERENCES RECEIPTS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE TAXLINES ADD CONSTRAINT TAXLINES_TAX FOREIGN KEY (TAXID, SITEGUID) REFERENCES TAXES(ID, SITEGUID)</sql>
        <sql>ALTER TABLE TAXLINES ADD CONSTRAINT TAXLINES_RECEIPT FOREIGN KEY (RECEIPT, SITEGUID) REFERENCES RECEIPTS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE PLACES ADD CONSTRAINT PLACES_FK_1 FOREIGN KEY (FLOOR, SITEGUID) REFERENCES FLOORS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE RESERVATION_CUSTOMERS ADD CONSTRAINT RES_CUST_FK_1 FOREIGN KEY (ID, SITEGUID) REFERENCES RESERVATIONS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE RESERVATION_CUSTOMERS ADD CONSTRAINT RES_CUST_FK_2 FOREIGN KEY (CUSTOMER, SITEGUID) REFERENCES CUSTOMERS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE LEAVES ADD CONSTRAINT LEAVES_PPLID FOREIGN KEY (PPLID, SITEGUID) REFERENCES PEOPLE(ID, SITEGUID)</sql>
        <sql>ALTER TABLE SHIFT_BREAKS ADD CONSTRAINT SHIFT_BREAKS_BREAKID FOREIGN KEY (BREAKID, SITEGUID) REFERENCES BREAKS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE SHIFT_BREAKS ADD CONSTRAINT SHIFT_BREAKS_SHIFTID FOREIGN KEY (SHIFTID, SITEGUID) REFERENCES SHIFTS(ID, SITEGUID) </sql>        
        <sql>ALTER TABLE PRODUCTS_KIT ADD CONSTRAINT PRODUCTS_KIT_FK_1 FOREIGN KEY (PRODUCT, SITEGUID) REFERENCES PRODUCTS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE PRODUCTS_KIT ADD CONSTRAINT PRODUCTS_KIT_FK_2 FOREIGN KEY (PRODUCT_KIT, SITEGUID) REFERENCES PRODUCTS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE PRODUCTS ADD CONSTRAINT FK_PRODUCT_PROMOTIONID FOREIGN KEY (PROMOTIONID, SITEGUID) REFERENCES PROMOTIONS(ID, SITEGUID)</sql>
        <sql>ALTER TABLE PRODUCTS ADD CONSTRAINT PRODUCTS_PACKPRODUCT_FK FOREIGN KEY (PACKPRODUCT, SITEGUID) REFERENCES PRODUCTS(ID, SITEGUID)</sql>    
        <sql>set foreign_key_checks = 1</sql> 
    </changeSet>                          

    <!--    
    <changeSet author="Chromis POS" id="Add foreign keys prior to v0.7 pt mysql" dbms="mysql"> 
        <sql>ALTER TABLE SHIFT_BREAKS ADD CONSTRAINT SHIFT_BREAKS_SHIFTID FOREIGN KEY (SHIFTID) REFERENCES SHIFTS(ID)</sql> 
    </changeSet>  
     
     <changeSet author="Chromis POS" id="Add foreign keys prior to v0.7 pt mysql" dbms="derby,postgresql"> 
         <sql>ALTER TABLE SHIFT_BREAKS ADD CONSTRAINT SHIFT_BREAKS_SHIFTID FOREIGN KEY (SHIFTID, SITEGUID) REFERENCES SHIFTS(ID, SITEGUID)</sql> 
     </changeSet> 
    -->         
                          
</databaseChangeLog>

